# This program will iterate through files in a directory and calculate the percentages of each file type.
# Edit the if statement as necessary for new file types found.

import subprocess
import os
import sys
from io import StringIO

txtcount = 0
gcount = 0
exe = 0
empty = 0
unknown = 0
keyfile = 0
shell = 0
total = 0

# create the mergeFile.txt and go to working directory
directory = os.fsencode("/home/") # change this

with open('mergeFile.txt', 'w') as outfile:
	for file in os.listdir(directory):
		total = total + 1
		filename = os.fsdecode(file)
		out = subprocess.Popen(['file', file],
		    stdout=subprocess.PIPE,
		    stderr=subprocess.STDOUT)

		stdout,stderr = out.communicate()

		if b'text' in stdout:
			txtcount += 1
		elif b'gzip' in stdout:
			gcount += 1
		elif b'shell' in stdout:
			shell += 1
		elif b'executable' in stdout:
			exe += 1
		elif b'empty' in stdout:
			empty += 1
		elif b'key' in stdout:
			keyfile += 1
		else:
			unknown += 1
			print("Unknown file type encountered!")
			print(stdout)    

print("Unknown file types: ", unknown)
print("executable files found: ", exe)
print("gzip files found: ", gcount)
print("shell scripts found: ", shell)
print("Empty files: ", empty)
print("Text files found: ", txtcount)
print("Total files checked: ", total)

txtPercent = 100 * float(txtcount)/float(total)
gzPercent = 100 * float(gcount)/float(total)
shellPercent = 100 * float(shell)/float(total)
exePercent = 100 * float(exe)/float(total)
empty = 100 * float(empty)/float(total)

print("Percentage of textfiles: ", txtPercent)
print("Percentage of gZip files: ", gzPercent)
print("Percentage of shell scripts: ", shellPercent)
print("Percentage of executable files: ", exePercent)
print("Percentage of empty files: ", empty)








